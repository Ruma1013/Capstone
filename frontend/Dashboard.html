<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Title Here</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>

<body>

    <header>
        <a class="logo" href="/"><img src="" alt="logo"></a>
        <a class="cta" href="payment.html">Pay Fines</a>
        <a class="logo" href="/"><div class="b"><img src="Images/profile.svg" alt="profile"></div></a>
    </header>

    <div class="main-container">
        <div class="sidebar">
            <ul>
                <li><a href="qr.html"><i class="fas fa-columns"></i> Dashboard</a></li>
                <li><a href="about.html"><i class="fas fa-users"></i> About Us</a></li>
                <li><a href="help.html"><i class="fas fa-question-circle"></i> Help</a></li>
            </ul>
        </div>
        <div id="content">

            <p>DashBoard</p>

            <div class="first_line">
                <p>Realtime insight on various activities.</p>
            </div>

            <table>
                <thead>
                    <tr>
                        <th> <div class="second_line">
                            <p>Outstanding Fines</p>
                        </div>
                        </th>
                        <th> <div class="second_line">
                            <p>My License Details</p>
                        </div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>
                            <div class="card">
                                <table>
                                  <!-- Add a section to display outstanding fines -->
                                    <div class="outstanding-fines">
                                        <div id="outstandingFinesContainer"></div>
                                    </div>
                                    
                                </table>
                              </div>
                    
                            <div class="second_line">
                                <p>Fine History</p>
                            </div> 
                    
                            <div class="card">
                                <table>
                                  <thead>
                                    <tr class="d">
                                      <th>Violation Type</th>
                                      <th >Policeman Name</th>
                                      <th >Date</th>
                                      <th class="b">Amount</th>
                            
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr class="e">
                                        <td>Violation Name01</td>
                                        <td class ="c">Policeman Name02</td>
                                        <td class ="c">13 Nov 2020</td>
                                        <td class="b">LKR.5000.00</td>
                                        
                                      </tr>
                                      <tr class="e">
                                        <td>Violation Name01</td>
                                        <td class ="c">Policeman Name02</td>
                                        <td class ="c">13 Nov 2020</td>
                                        <td class="b">LKR.6000.00</td>
                                        
                                      </tr>
                                      <tr class="e">
                                        <td>Violation Name01</td>
                                        <td class ="c">Policeman Name02</td>
                                        <td class ="c">13 Nov 2020</td>
                                        <td class="b">LKR.6000.00</td>
                                        
                                      </tr>
                                    </table>

                                    
                        </th>
                        <th class="i">
                            <div class="card2">
                                <table>
                                    <thead>
                                        <tr class="g">
                                            <th colspan="2" class="g">Driving license</th>
                                        </tr>
                                        <tr class="space-row"></tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                          <td rowspan="8"><img src="Images/dp.png" width="100"></td>
                                          <td class="h">License Holder's Name:</td>
                                        </tr>
                                        <tr>
                                          <td class="f" id="name"></td>
                                        </tr>
                                        <tr>
                                          <td class="h">DOB:</td>
                                        </tr>
                                        <tr>
                                          <td class="f" id="dob"></td>
                                        </tr>
                                        <td class="h">Address:</td>
                                      </tr>
                                      <tr>
                                        <td class="f" id="address"></td>
                                      </tr>
                                      <tr>
                                        <td class="h">Blood Type:</td>
                                      </tr>
                                      <tr>
                                        <td class="f">B+</td>
                                      </tr>
                                      <tr>
                                        <td class="h">Date of Issue:</td>
                                        <td class="h">License Class:</td>
                                      </tr>
                                      <tr>
                                        <td class="f" id="doi"></td>
                                        <td class="f" id="VC"></td>
                                      </tr>
                                      <tr>
                                        <td class="h">Expiry Date:</td>
                                        <td class="h">License Number:</td>
                                      </tr>
                                      <tr>
                                        <td class="f" id="doe"></td>
                                        <td class="f" id="lC"></td>
                                      </tr>
                                      <tr>
                                        <td class="h">Issuing Authority:</td>
                                        <td class="h">Administrative Number:</td>
                                      </tr>
                                      <tr>
                                        <td class="f">ID Number: </td>
                                        <td class="f" id="ID"></td>
                                      </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="qr">
                                <div class="second_line">
                                    <a href="qr.html" class="qr-btn">Download QR</a>
                                </div>
                            </div>
                        </th>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
    // After retrieving user details, check for outstanding fines
window.onload = async function () {
  const userDetails = JSON.parse(localStorage.getItem('userDetails'));
  console.log("Retrieved user details:", userDetails);

  if (userDetails) {
    console.log("User details found in local storage:", userDetails);
    document.getElementById('name').innerText = userDetails.name || 'N/A';
    document.getElementById('dob').innerText = userDetails.dob || 'N/A';
    document.getElementById('address').innerText = userDetails.address || 'N/A';
    document.getElementById('doi').innerText = userDetails.doi || 'N/A';
    document.getElementById('doe').innerText = userDetails.doe || 'N/A';
    document.getElementById('ID').innerText = userDetails.ID || 'N/A';
    document.getElementById('VC').innerText = userDetails.VC || 'N/A';
    document.getElementById('lC').innerText = userDetails.lC || 'N/A';

    // Retrieve outstanding fines
    try {
      const response = await fetch('/api/outstandingFines', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ licenseNumber: userDetails.lC }),
      });

      const data = await response.json();

      if (data.success) {
        const finesContainer = document.getElementById('outstandingFinesContainer');
        if (data.fines.length > 0) {
          finesContainer.innerHTML = ''; // Clear previous content
          data.fines.forEach(fine => {
            finesContainer.innerHTML += `
              <div class="fine">
                <p><strong>Fine Description:</strong> ${fine.FineDes}</p>
                <p><strong>Fine Amount:</strong> ${fine.FineAmount}</p>
                <p><strong>Date:</strong> ${fine.Date}</p>
                <p><strong>Police Officer:</strong> ${fine.PoliceMan}</p>
              </div>
            `;
          });
        } else {
          finesContainer.innerHTML = '<p>No outstanding fines</p>';
        }
      } else {
        console.error('Error retrieving outstanding fines:', data.error);
      }
    } catch (error) {
      console.error('Error retrieving outstanding fines:', error);
    }
  } else {
    console.log("User details not found in local storage.");
  }
};

</script>


</body>

</html>
